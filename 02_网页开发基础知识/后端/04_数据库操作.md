# æ•°æ®åº“æ“ä½œ

> **æ–¹æ³•è®º**: æ•°æ®åº“å°±æ˜¯ Excel è¡¨æ ¼ï¼Œå­¦ä¼šå¢åˆ æ”¹æŸ¥å°±å¤Ÿäº†ã€‚

---

## ğŸ“– æœ¬èŠ‚ç›®æ ‡

å­¦å®Œæœ¬èŠ‚ï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… åœ¨ Supabase åˆ›å»ºç”¨æˆ·è¡¨ï¼ˆåƒåˆ›å»º Excel è¡¨æ ¼ä¸€æ ·ç®€å•ï¼‰
- âœ… ç†è§£æ•°æ®åº“çš„"å¢åˆ æ”¹æŸ¥"ï¼ˆè¿™æ˜¯æœ€æ ¸å¿ƒçš„ï¼‰
- âœ… ç”¨ Python ä»£ç æ’å…¥/æŸ¥è¯¢æ•°æ®ï¼ˆå¤åˆ¶ç²˜è´´å°±èƒ½ç”¨ï¼‰
- âœ… å®ç°æ³¨å†Œæ¥å£è¿æ¥çœŸå®æ•°æ®åº“ï¼ˆçœŸæ­£èƒ½ç”¨çš„åŠŸèƒ½ï¼‰

**é¢„è®¡ç”¨æ—¶**: 40 åˆ†é’Ÿ

**å®‰å¿ƒæç¤º**: è¿™èŠ‚è¯¾ä¼šå‡ºç°å¾ˆå¤šä»£ç ï¼Œä½†ä½ ä¸éœ€è¦è®°ä½å®ƒä»¬ï¼é‡ç‚¹æ˜¯ç†è§£"æ•°æ®æ€ä¹ˆå­˜ã€æ€ä¹ˆå–"çš„é€»è¾‘ï¼Œå…·ä½“ä»£ç å¯ä»¥è®© AI å¸®ä½ å†™ã€‚

---

## 1. åœ¨ Supabase åˆ›å»ºè¡¨

### 1.1 å›é¡¾ï¼šæ•°æ®åº“ = Excel

è¿˜è®°å¾—ç¬¬ä¸€èŠ‚è®²çš„å—ï¼Ÿ

**æ•°æ®åº“ = ä¸€å † Excel è¡¨æ ¼çš„é›†åˆ**

```
ç”¨æˆ·è¡¨ (users)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ username â”‚ email               â”‚ password_hashâ”‚ created_at          â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ zhangsan â”‚ zhang@example.com   â”‚ abc123...    â”‚ 2025-01-15 10:30:00 â”‚
â”‚ 2  â”‚ lisi     â”‚ li@example.com      â”‚ def456...    â”‚ 2025-01-15 11:00:00 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 åˆ›å»ºç”¨æˆ·è¡¨ï¼ˆusersï¼‰

**æ­¥éª¤1: è¿›å…¥ Table Editor**

1. ç™»å½• [supabase.com](https://supabase.com/)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. å·¦ä¾§èœå•ç‚¹å‡» "Table Editor"

**æ­¥éª¤2: åˆ›å»ºæ–°è¡¨**

1. ç‚¹å‡» "Create a new table"
2. å¡«å†™ä¿¡æ¯ï¼š

**è¡¨åŸºæœ¬ä¿¡æ¯**:
- **Name**: `users`
- **Description**: ç”¨æˆ·è¡¨

**è¡¨å­—æ®µï¼ˆColumnsï¼‰**:

| åˆ—å | ç±»å‹ | é»˜è®¤å€¼ | å…¶ä»–è®¾ç½® |
|------|------|--------|----------|
| `id` | `int8` | è‡ªåŠ¨ç”Ÿæˆ | âœ… Primary Key |
| `username` | `text` | - | âœ… Unique, âœ… Not Null |
| `email` | `text` | - | å¯é€‰ |
| `password_hash` | `text` | - | âœ… Not Null |
| `created_at` | `timestamptz` | `now()` | - |

3. ç‚¹å‡» "Save" åˆ›å»ºè¡¨

**æˆåŠŸï¼ä½ çš„ç¬¬ä¸€å¼ è¡¨åˆ›å»ºå¥½äº†ï¼** ğŸ‰

### 1.3 ç†è§£å­—æ®µå«ä¹‰ï¼ˆç”Ÿæ´»åŒ–è§£é‡Šï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç”Ÿæ´»åŒ–ç±»æ¯” |
|------|------|------|-----------|
| **id** | `int8` (æ•´æ•°) | ä¸»é”®ï¼Œå”¯ä¸€æ ‡è¯†æ¯ä¸ªç”¨æˆ· | **= èº«ä»½è¯å·** æ¯ä¸ªäººç‹¬ä¸€æ— äºŒ |
| **username** | `text` (æ–‡æœ¬) | ç”¨æˆ·åï¼Œå”¯ä¸€ä¸èƒ½é‡å¤ | **= ä½ çš„æ˜µç§°** ä¸èƒ½å’Œåˆ«äººé‡å¤ |
| **email** | `text` (æ–‡æœ¬) | é‚®ç®± | **= ä½ çš„é‚®ç®±åœ°å€** å¯ä»¥ä¸å¡« |
| **password_hash** | `text` (æ–‡æœ¬) | åŠ å¯†åçš„å¯†ç  | **= å¯†ç çš„åŠ å¯†å½¢å¼** é»‘å®¢çœ‹äº†ä¹Ÿæ²¡ç”¨ |
| **created_at** | `timestamptz` (æ—¶é—´) | åˆ›å»ºæ—¶é—´ï¼Œè‡ªåŠ¨å¡«å…… | **= æ³¨å†Œæ—¶é—´** è‡ªåŠ¨è®°å½•ï¼Œä¸ç”¨ä½ ç®¡ |

**çœ‹æ™•äº†æ²¡å…³ç³»ï¼** è¿™äº›ä¸“ä¸šæœ¯è¯­ï¼ˆ`int8`ã€`timestamptz`ï¼‰éƒ½æ˜¯ç»™æ•°æ®åº“çœ‹çš„ï¼Œä½ åªéœ€è¦çŸ¥é“ï¼š
- `int8` = æ•°å­—ï¼ˆåƒèº«ä»½è¯å·ï¼‰
- `text` = æ–‡å­—ï¼ˆåƒåå­—ï¼‰
- `timestamptz` = æ—¶é—´ï¼ˆè‡ªåŠ¨è®°å½•ï¼Œè¿˜èƒ½å¤„ç†æ—¶åŒºé—®é¢˜ï¼‰

**å¦‚ä½•è®© AI å¸®å¿™ï¼Ÿ** å½“ä½ è¦åˆ›å»ºæ–°è¡¨æ—¶ï¼Œç›´æ¥å¯¹ AI è¯´ï¼š"å¸®æˆ‘è®¾è®¡ä¸€ä¸ªXXè¡¨ï¼Œéœ€è¦å­˜XXXä¿¡æ¯"ï¼Œå®ƒä¼šå‘Šè¯‰ä½ ç”¨ä»€ä¹ˆç±»å‹ã€‚

---

## 2. SQL åŸºç¡€ CRUD

### 2.1 ä»€ä¹ˆæ˜¯ SQLï¼Ÿ

**SQL = å’Œæ•°æ®åº“å¯¹è¯çš„è¯­è¨€**

å°±åƒä½ ç”¨ä¸­æ–‡å’Œäººå¯¹è¯ï¼Œç”¨ SQL å’Œæ•°æ®åº“å¯¹è¯ã€‚

**é‡è¦è¯´æ˜ï¼šä¸ºä»€ä¹ˆè¦å­¦ SQLï¼Ÿ**
- SQL æ˜¯æ•°æ®åº“çš„"é€šç”¨è¯­è¨€"ï¼Œä¼šäº†å®ƒä½ å°±æ‡‚æ•°æ®åº“çš„å·¥ä½œåŸç†
- ä½†æ˜¯å†™ç½‘ç«™æ—¶ï¼Œä½ ä¸»è¦ä¼šç”¨ **Python SDK**ï¼ˆç¬¬ 3 èŠ‚ï¼‰ï¼Œä¸éœ€è¦æ‰‹å†™ SQL
- è¿™é‡Œçš„ SQL ä¸»è¦æ˜¯ï¼š
  1. **ç†è§£æ¦‚å¿µ**ï¼ˆçŸ¥é“å¢åˆ æ”¹æŸ¥æ˜¯ä»€ä¹ˆï¼‰
  2. **è°ƒè¯•å·¥å…·**ï¼ˆåœ¨ Supabase SQL Editor é‡Œå¿«é€Ÿæµ‹è¯•ï¼‰
  3. **è®© AI å¸®ä½ å†™**ï¼ˆç»™ AI æè¿°éœ€æ±‚ï¼Œå®ƒä¼šç”Ÿæˆ SQLï¼‰

**AI åä½œæç¤º**ï¼šä½ å¯ä»¥å¯¹ AI è¯´ï¼š"å¸®æˆ‘å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰é‚®ç®±ä¸ä¸ºç©ºçš„ç”¨æˆ·"ï¼Œå®ƒä¼šç›´æ¥ç”Ÿæˆä»£ç ã€‚

### 2.2 æ’å…¥æ•°æ®ï¼ˆINSERTï¼‰

**è¯­æ³•**:

```sql
INSERT INTO è¡¨å (åˆ—1, åˆ—2, åˆ—3)
VALUES (å€¼1, å€¼2, å€¼3);
```

**å®é™…ä¾‹å­**ï¼ˆåœ¨ Supabase SQL Editor è¿è¡Œï¼‰:

1. å·¦ä¾§èœå•ç‚¹å‡» "SQL Editor"
2. ç‚¹å‡» "New query"
3. è¾“å…¥ï¼š

```sql
INSERT INTO users (username, email, password_hash)
VALUES ('zhangsan', 'zhang@example.com', 'abc123hashed');
```

4. ç‚¹å‡» "Run" æˆ–æŒ‰ `Ctrl+Enter`

**æˆåŠŸï¼** åˆ·æ–° Table Editorï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ–°å¢çš„æ•°æ®ã€‚

### 2.3 æŸ¥è¯¢æ•°æ®ï¼ˆSELECTï¼‰

**æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·**:

```sql
SELECT * FROM users;
```

**æ¡ä»¶æŸ¥è¯¢**ï¼ˆæŸ¥æ‰¾ç”¨æˆ·åä¸º zhangsan çš„ç”¨æˆ·ï¼‰:

```sql
SELECT * FROM users WHERE username = 'zhangsan';
```

**åªæŸ¥è¯¢ç‰¹å®šå­—æ®µ**:

```sql
SELECT id, username, email FROM users;
```

**æ’åº**ï¼ˆæŒ‰åˆ›å»ºæ—¶é—´å€’åºï¼‰:

```sql
SELECT * FROM users ORDER BY created_at DESC;
```

**é™åˆ¶è¿”å›æ•°é‡**ï¼ˆåªè¿”å›å‰ 10 æ¡ï¼‰:

```sql
SELECT * FROM users LIMIT 10;
```

**ç»„åˆä½¿ç”¨**:

```sql
SELECT id, username, email
FROM users
WHERE email IS NOT NULL
ORDER BY created_at DESC
LIMIT 10;
```

### 2.4 æ›´æ–°æ•°æ®ï¼ˆUPDATEï¼‰

**è¯­æ³•**:

```sql
UPDATE è¡¨å
SET åˆ—1 = æ–°å€¼1, åˆ—2 = æ–°å€¼2
WHERE æ¡ä»¶;
```

**å®é™…ä¾‹å­**:

```sql
UPDATE users
SET email = 'new_email@example.com'
WHERE username = 'zhangsan';
```

**âš ï¸ é‡è¦**: `WHERE` æ¡ä»¶ä¸€å®šè¦å†™ï¼å¦åˆ™ä¼šæ›´æ–°æ‰€æœ‰è¡Œï¼

### 2.5 åˆ é™¤æ•°æ®ï¼ˆDELETEï¼‰

**è¯­æ³•**:

```sql
DELETE FROM è¡¨å WHERE æ¡ä»¶;
```

**å®é™…ä¾‹å­**:

```sql
DELETE FROM users WHERE id = 1;
```

**âš ï¸ å±é™©**: å®é™…é¡¹ç›®å»ºè®®ç”¨"è½¯åˆ é™¤"ï¼ˆæ·»åŠ  `is_deleted` å­—æ®µï¼‰ï¼Œè€Œä¸æ˜¯çœŸåˆ é™¤ã€‚

---

## 3. ç”¨ Python è¿æ¥ Supabase

**è¿™æ‰æ˜¯é‡ç‚¹ï¼** ä»è¿™é‡Œå¼€å§‹ï¼Œä½ ä¼šå­¦åˆ°åœ¨çœŸå®é¡¹ç›®ä¸­å¦‚ä½•ç”¨ Python æ“ä½œæ•°æ®åº“ã€‚å‰é¢çš„ SQL ä½ çœ‹æ‡‚æ¦‚å¿µå°±è¡Œï¼Œå…·ä½“å†™ä»£ç ä¸»è¦ç”¨è¿™èŠ‚çš„æ–¹æ³•ã€‚

### 3.0 æ–‡ä»¶ç»“æ„è¯´æ˜ï¼ˆå…ˆçœ‹è¿™é‡Œï¼ï¼‰

åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œæˆ‘ä»¬è¦å»ºç«‹è¿™æ ·çš„æ–‡ä»¶å¤¹ç»“æ„ï¼š

```text
æˆ‘çš„é¡¹ç›®/
â”œâ”€â”€ db_config.py      # æ•°æ®åº“è¿æ¥é…ç½®ï¼ˆä¸“é—¨å­˜ Supabase URL å’Œ Keyï¼‰
â”œâ”€â”€ main.py           # ä¸»ç¨‹åºï¼ˆä½ çš„ FastAPI åº”ç”¨ï¼‰
â””â”€â”€ test_db.py        # æµ‹è¯•æ–‡ä»¶ï¼ˆæµ‹è¯•æ•°æ®åº“è¿æ¥ï¼Œæµ‹å®Œå¯ä»¥åˆ ï¼‰
```

**ä¸ºä»€ä¹ˆè¦åˆ†æ–‡ä»¶ï¼Ÿ**
- `db_config.py`ï¼šæŠŠå¯†ç ï¼ˆKeyï¼‰å•ç‹¬æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œå®‰å…¨+æ–¹ä¾¿ç®¡ç†
- `main.py`ï¼šä¸»ç¨‹åºï¼Œè¿™é‡Œå†™ä½ çš„æ¥å£ä»£ç 
- `test_db.py`ï¼šå…ˆç”¨è¿™ä¸ªæ–‡ä»¶æµ‹è¯•èƒ½ä¸èƒ½è¿ä¸Šæ•°æ®åº“ï¼Œæµ‹é€šäº†å†å†™ä¸»ç¨‹åº

### 3.1 å®‰è£… Supabase åº“

```bash
pip install supabase
```

**å¦‚æœæŠ¥é”™æ€ä¹ˆåŠï¼Ÿ**ï¼ˆå¸¸è§é—®é¢˜ï¼‰

**æŠ¥é”™ 1**: `pip: command not found`
- **åŸå› **: Python æ²¡è£…å¥½æˆ–è€…ç¯å¢ƒå˜é‡æ²¡é…ç½®
- **AI æç¤º**: å¤åˆ¶è¿™ä¸ªæŠ¥é”™ï¼Œé—® AIï¼š"æˆ‘è¿è¡Œ pip install supabase æŠ¥é”™äº†ï¼š[ç²˜è´´æŠ¥é”™å†…å®¹]ï¼Œæ€ä¹ˆåŠï¼Ÿ"

**æŠ¥é”™ 2**: `ERROR: Could not find a version...`
- **åŸå› **: ç½‘ç»œé—®é¢˜æˆ–è€…æ‹¼å†™é”™è¯¯
- **è§£å†³**: æ£€æŸ¥ç½‘ç»œï¼Œç¡®è®¤å‘½ä»¤æ‹¼å†™æ­£ç¡®ï¼Œæˆ–è€…æ¢ä¸ªé•œåƒæºï¼ˆé—® AIï¼š"pip å®‰è£…æŠ¥é”™æ€ä¹ˆæ¢é•œåƒæºï¼Ÿ"ï¼‰

### 3.2 è·å–è¿æ¥ä¿¡æ¯

åœ¨ Supabase é¡¹ç›®ä¸­ï¼š

1. ç‚¹å‡»å·¦ä¾§ "Settings"ï¼ˆé½¿è½®å›¾æ ‡ï¼‰
2. ç‚¹å‡» "API"
3. æ‰¾åˆ°è¿™ä¸¤ä¸ªä¿¡æ¯ï¼š
   - **Project URL**: `https://xxx.supabase.co`
   - **anon public key**: ä¸€ä¸²å¾ˆé•¿çš„å­—ç¬¦ä¸²

### 3.3 åˆ›å»ºè¿æ¥

**åˆ›å»º `db_config.py`**ï¼ˆåœ¨é¡¹ç›®æ–‡ä»¶å¤¹é‡Œæ–°å»ºè¿™ä¸ªæ–‡ä»¶ï¼‰:

```python
from supabase import create_client, Client

# Supabase è¿æ¥é…ç½®
SUPABASE_URL = "https://xxx.supabase.co"  # æ›¿æ¢æˆä½ çš„ URL
SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI..."  # æ›¿æ¢æˆä½ çš„ Key

# åˆ›å»ºå®¢æˆ·ç«¯
supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)
```

**ä»£ç è§£é‡Šï¼ˆä½ éœ€è¦æ‡‚çš„é€»è¾‘ï¼‰**ï¼š
- `SUPABASE_URL` å’Œ `SUPABASE_KEY`ï¼šè¿™æ˜¯ä½ å®¶é—¨ç‰Œå·+é’¥åŒ™ï¼Œå‘Šè¯‰ Python "å»å“ªé‡Œæ‰¾æ•°æ®åº“"
- `create_client`ï¼šè¿™è¡Œä»£ç å»ºç«‹è¿æ¥ï¼Œå°±åƒæ‹¿ç€é’¥åŒ™å¼€é—¨
- `supabase`ï¼šè¿™æ˜¯è¿æ¥å¯¹è±¡ï¼Œåé¢æ‰€æœ‰æ“ä½œéƒ½é€šè¿‡å®ƒ

**ä½ ä¸éœ€è¦æ‡‚çš„è¯­æ³•ç»†èŠ‚**ï¼ˆè®© AI å†™å°±è¡Œï¼‰ï¼š
- `: Client` æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆç±»å‹æ³¨è§£ï¼Œæœºå™¨çœ‹çš„ï¼Œä½ ä¸ç”¨ç®¡ï¼‰
- `create_client` çš„å®ç°åŸç†ï¼Ÿï¼ˆåº•å±‚å°è£…ï¼Œä½ ä¸ç”¨ç®¡ï¼‰

**AI åä½œæç¤º**ï¼šå¦‚æœ Key å¡«é”™äº†è¿ä¸ä¸Šï¼Œå¤åˆ¶æŠ¥é”™ä¿¡æ¯é—® AIï¼š"æˆ‘çš„ Supabase è¿æ¥æŠ¥é”™äº†ï¼š[æŠ¥é”™å†…å®¹]ï¼Œæ€ä¹ˆæ£€æŸ¥ï¼Ÿ"

**å®‰å…¨æç¤ºï¼ˆé‡è¦ï¼ï¼‰**ï¼š
- è¿™ä¸ª `SUPABASE_KEY` æ˜¯ä½ çš„æ•°æ®åº“é’¥åŒ™ï¼Œ**ä¸è¦åˆ†äº«ç»™åˆ«äºº**ï¼
- å¦‚æœè¦æŠŠä»£ç ä¸Šä¼ åˆ° GitHub æˆ–å‘ç»™æœ‹å‹ï¼Œè®°å¾—ï¼š
  1. å…ˆåˆ›å»ºä¸€ä¸ª `.gitignore` æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Š `db_config.py`ï¼ˆè¿™æ · Git å°±ä¸ä¼šä¸Šä¼ å®ƒï¼‰
  2. æˆ–è€…åˆ†äº«ä»£ç æ—¶æŠŠ Key åˆ æ‰ï¼Œåªç•™ä¸ªç¤ºä¾‹ï¼š"æ›¿æ¢æˆä½ çš„ Key"
- å¦‚æœä¸å°å¿ƒæ³„éœ²äº† Keyï¼Œå» Supabase é¡¹ç›®è®¾ç½®é‡Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ï¼ˆåˆ«æ‹…å¿ƒï¼Œå¾ˆç®€å•ï¼‰

### 3.4 æ’å…¥æ•°æ®

**åˆ›å»º `test_db.py`**:

```python
from db_config import supabase

# æ’å…¥ä¸€æ¡ç”¨æˆ·æ•°æ®
data = {
    "username": "test_user",
    "email": "test@example.com",
    "password_hash": "hashed_password_123"
}

response = supabase.table('users').insert(data).execute()

print("æ’å…¥æˆåŠŸï¼")
print("æ–°ç”¨æˆ· ID:", response.data[0]['id'])
```

**è¿è¡Œ**:

```bash
python test_db.py
```

### 3.5 æŸ¥è¯¢æ•°æ®

```python
from db_config import supabase

# æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
response = supabase.table('users').select("*").execute()

print("æ‰€æœ‰ç”¨æˆ·:")
for user in response.data:
    print(f"ID: {user['id']}, ç”¨æˆ·å: {user['username']}")

# æ¡ä»¶æŸ¥è¯¢
response = supabase.table('users').select("*").eq('username', 'zhangsan').execute()

if response.data:
    print("æ‰¾åˆ°ç”¨æˆ·:", response.data[0])
else:
    print("ç”¨æˆ·ä¸å­˜åœ¨")
```

### 3.6 æ›´æ–°æ•°æ®

```python
from db_config import supabase

# æ›´æ–°ç”¨æˆ·é‚®ç®±
supabase.table('users').update({
    "email": "new_email@example.com"
}).eq('username', 'zhangsan').execute()

print("æ›´æ–°æˆåŠŸï¼")
```

### 3.7 åˆ é™¤æ•°æ®

```python
from db_config import supabase

# åˆ é™¤ç”¨æˆ·
supabase.table('users').delete().eq('id', 1).execute()

print("åˆ é™¤æˆåŠŸï¼")
```

---

## 4. å®æˆ˜ï¼šç”¨æˆ·æ³¨å†Œè¿æ¥æ•°æ®åº“

### 4.1 å®Œæ•´ä»£ç 

**`db_config.py`** (æ•°æ®åº“é…ç½®):

```python
from supabase import create_client, Client

SUPABASE_URL = "https://xxx.supabase.co"  # æ›¿æ¢
SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI..."  # æ›¿æ¢

supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)
```

**`main.py`** (ä¸»ç¨‹åº):

```python
from fastapi import FastAPI
from pydantic import BaseModel, Field, EmailStr
from typing import Optional, Any
import hashlib
from db_config import supabase

# ===== æ•°æ®æ¨¡å‹ =====

class UserRegisterRequest(BaseModel):
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=6)
    email: Optional[EmailStr] = None

class Response(BaseModel):
    code: int
    msg: str
    data: Optional[Any] = None

class R:
    @staticmethod
    def success(data: Any = None, msg: str = "æ“ä½œæˆåŠŸ"):
        return Response(code=200, msg=msg, data=data)

    @staticmethod
    def error(msg: str = "æ“ä½œå¤±è´¥", code: int = 500):
        return Response(code=code, msg=msg, data=None)

# ===== FastAPI åº”ç”¨ =====

app = FastAPI(title="æˆ‘çš„åç«¯ API", version="1.0.0")

@app.post("/api/users/register", response_model=Response)
def register(user: UserRegisterRequest):
    """ç”¨æˆ·æ³¨å†Œæ¥å£ï¼ˆè¿æ¥çœŸå®æ•°æ®åº“ï¼‰"""

    # 1. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
    existing_user = supabase.table('users').select("*").eq('username', user.username).execute()

    if existing_user.data:
        return R.error(msg="ç”¨æˆ·åå·²å­˜åœ¨", code=400)

    # 2. å¯†ç åŠ å¯†
    password_hash = hashlib.sha256(user.password.encode()).hexdigest()

    # 3. æ’å…¥æ•°æ®åº“
    try:
        new_user = supabase.table('users').insert({
            "username": user.username,
            "email": user.email,
            "password_hash": password_hash
        }).execute()

        return R.success(
            msg="æ³¨å†ŒæˆåŠŸ",
            data={"user_id": new_user.data[0]['id']}
        )

    except Exception as e:
        return R.error(msg=f"æ³¨å†Œå¤±è´¥: {str(e)}", code=500)

@app.get("/api/users", response_model=Response)
def list_users():
    """æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·"""
    response = supabase.table('users').select("id, username, email, created_at").execute()
    return R.success(data=response.data)

@app.get("/api/users/{user_id}", response_model=Response)
def get_user(user_id: int):
    """è·å–å•ä¸ªç”¨æˆ·ä¿¡æ¯"""
    response = supabase.table('users').select("*").eq('id', user_id).execute()

    if not response.data:
        return R.error(msg="ç”¨æˆ·ä¸å­˜åœ¨", code=404)

    return R.success(data=response.data[0])

# ===== å¯åŠ¨åº”ç”¨ =====

if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

### 4.2 æµ‹è¯•

**å¯åŠ¨åº”ç”¨**:

```bash
python main.py
```

**æµ‹è¯•æ³¨å†Œ**ï¼ˆè®¿é—® http://localhost:8000/docsï¼‰:

```json
POST /api/users/register
{
  "username": "xiaoming",
  "password": "123456",
  "email": "xiaoming@example.com"
}
```

**æˆåŠŸå“åº”**:

```json
{
  "code": 200,
  "msg": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user_id": 3
  }
}
```

**åœ¨ Supabase Table Editor æŸ¥çœ‹**ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ–°å¢çš„ç”¨æˆ·ï¼

---

## 5. SQLAlchemy ORM å…¥é—¨ï¼ˆè¿›é˜¶ï¼Œåˆå­¦è€…å¯è·³è¿‡ï¼‰

**é‡è¦æç¤ºï¼šæ–°æ‰‹å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€èŠ‚ï¼** å‰é¢å­¦çš„ Supabase SDK å·²ç»å®Œå…¨å¤Ÿç”¨äº†ã€‚è¿™ä¸€èŠ‚æ˜¯ç»™ä»¥åæƒ³æ·±å…¥äº†è§£çš„äººå‡†å¤‡çš„ã€‚

### 5.1 ä»€ä¹ˆæ˜¯ ORMï¼Ÿ

**ORM = Object-Relational Mappingï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰**

**é€šä¿—è§£é‡Šï¼ˆç¿»è¯‘å®˜ç±»æ¯”ï¼‰**ï¼š

æƒ³è±¡ä½ è¦å’Œä¸€ä¸ªåªä¼šå¾·è¯­çš„äººäº¤æµï¼Œä½†ä½ ä¸ä¼šå¾·è¯­ï¼š
- **ä¸ç”¨ ORM**ï¼šä½ å¾—å…ˆå­¦å¾·è¯­ï¼Œç„¶åå†™å¾·è¯­å¥å­ï¼ˆ= æ‰‹å†™ SQL è¯­å¥ï¼‰
- **ç”¨ ORM**ï¼šä½ æ‰¾äº†ä¸ªç¿»è¯‘å®˜ï¼Œä½ è¯´ä¸­æ–‡ï¼ˆ= å†™ Python å¯¹è±¡ï¼‰ï¼Œç¿»è¯‘å®˜è‡ªåŠ¨å¸®ä½ ç¿»è¯‘æˆå¾·è¯­ï¼ˆ= ORM è‡ªåŠ¨ç”Ÿæˆ SQLï¼‰

```
ä½ çš„ä»£ç ï¼šuser = User(username='zhangsan')
         â†“ (ORM è‡ªåŠ¨ç¿»è¯‘)
SQLè¯­å¥ï¼šINSERT INTO users (username) VALUES ('zhangsan')
```

### 5.2 ä¸ºä»€ä¹ˆè¿™ä¸€èŠ‚å¯ä»¥è·³è¿‡ï¼Ÿ

| åœºæ™¯ | Supabase SDK | SQLAlchemy ORM |
|------|-------------|----------------|
| **å­¦ä¹ éš¾åº¦** | âœ… ç®€å•ï¼ˆ5 åˆ†é’Ÿä¸Šæ‰‹ï¼‰ | âŒ å¤æ‚ï¼ˆéœ€è¦å­¦æ¨¡å‹å®šä¹‰ï¼‰ |
| **é€‚ç”¨æ•°æ®åº“** | åªèƒ½ç”¨ Supabase | ä»»ä½• SQL æ•°æ®åº“ |
| **æ˜¯å¦å¤Ÿç”¨** | âœ… å°é¡¹ç›®å®Œå…¨å¤Ÿ | å¤§å…¬å¸/å¤æ‚é¡¹ç›®æ‰éœ€è¦ |

**å»ºè®®**ï¼šç°åœ¨ç”¨ Supabase SDK å°±è¡Œï¼Œç­‰ä½ åšå¤§é¡¹ç›®æˆ–è€…å…¬å¸è¦æ±‚ç”¨æœ¬åœ°æ•°æ®åº“æ—¶ï¼Œå†å›æ¥å­¦è¿™ä¸€èŠ‚ã€‚

<details>
<summary>æƒ³äº†è§£çš„åŒå­¦ç‚¹è¿™é‡Œå±•å¼€ï¼ˆå¯é€‰ï¼‰</summary>

### 5.3 å®‰è£… SQLAlchemy

```bash
pip install sqlalchemy psycopg2-binary
```

### 5.4 å®šä¹‰æ¨¡å‹

**åˆ›å»º `models/user.py`**:

```python
from sqlalchemy import Column, Integer, String, DateTime
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

Base = declarative_base()

class User(Base):
    """ç”¨æˆ·è¡¨æ¨¡å‹"""
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, autoincrement=True)
    username = Column(String(50), unique=True, nullable=False)
    email = Column(String(100))
    password_hash = Column(String(255), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)

    def to_dict(self):
        """è½¬æ¢ä¸ºå­—å…¸"""
        return {
            "id": self.id,
            "username": self.username,
            "email": self.email,
            "created_at": self.created_at.isoformat() if self.created_at else None
        }
```

### 5.4 ä½¿ç”¨ ORMï¼ˆç¤ºä¾‹ï¼‰

**æ³¨æ„**: Supabase Python SDK å·²ç»å¾ˆæ–¹ä¾¿äº†ï¼ŒORM ä¸»è¦ç”¨äºæ›´å¤æ‚çš„åœºæ™¯ï¼ˆæœ¬åœ° PostgreSQLã€MySQL ç­‰ï¼‰ã€‚

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from models.user import User

# è¿æ¥æ•°æ®åº“ï¼ˆéœ€è¦ PostgreSQL è¿æ¥å­—ç¬¦ä¸²ï¼‰
DATABASE_URL = "postgresql://user:password@host:5432/database"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(bind=engine)

# ä½¿ç”¨
db = SessionLocal()

# åˆ›å»ºç”¨æˆ·
new_user = User(
    username="zhangsan",
    email="zhang@example.com",
    password_hash="hashed_password"
)
db.add(new_user)
db.commit()

# æŸ¥è¯¢ç”¨æˆ·
user = db.query(User).filter(User.username == "zhangsan").first()
print(user.to_dict())

# å…³é—­è¿æ¥
db.close()
```

</details>

**å†æ¬¡æé†’**ï¼šåˆå­¦è€…çœŸçš„ä¸éœ€è¦çœ‹è¿™ä¸€èŠ‚ï¼ç”¨ Supabase SDK å°±å¤Ÿäº†ã€‚

---

## 6. å¸¸è§é—®é¢˜

### Q1: Supabase SDK å’Œ SQLAlchemy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:

| ç‰¹æ€§ | Supabase SDK | SQLAlchemy ORM |
|------|-------------|----------------|
| **ç®€å•åº¦** | âœ… ç®€å•ç›´æ¥ | âš ï¸ éœ€è¦å®šä¹‰æ¨¡å‹ |
| **å­¦ä¹ æˆæœ¬** | ä½ | ä¸­ç­‰ |
| **é€‚ç”¨åœºæ™¯** | Supabase äº‘æ•°æ®åº“ | ä»»ä½• SQL æ•°æ®åº“ |
| **æ¨è** | æ–°æ‰‹/å°é¡¹ç›® | å¤§é¡¹ç›®/æœ¬åœ°æ•°æ®åº“ |

**å»ºè®®**: æœ¬é¡¹ç›®ç”¨ Supabase SDK å°±å¤Ÿäº†ã€‚

### Q2: ä¸ºä»€ä¹ˆä¸æŠŠå¯†ç æ˜æ–‡å­˜å‚¨ï¼Ÿ

**A**: æ•°æ®åº“è¢«é»‘å®¢å…¥ä¾µæ—¶ï¼Œç”¨æˆ·å¯†ç ä¸ä¼šæ³„éœ²ã€‚

```python
# âŒ æ˜æ–‡
password = "123456"  # é»‘å®¢ç›´æ¥çœ‹åˆ°

# âœ… åŠ å¯†
password_hash = "8d969eef6ecad3c29a3a629280e686cf0c3f5d5..."  # æ— æ³•åæ¨åŸå¯†ç 
```

### Q3: created_at æ—¶é—´ä¸å¯¹æ€ä¹ˆåŠï¼Ÿ

**A**: Supabase é»˜è®¤ç”¨ UTC æ—¶é—´ï¼Œéœ€è¦è½¬æ¢æˆæœ¬åœ°æ—¶é—´ã€‚

```python
from datetime import datetime, timezone

# UTC è½¬åŒ—äº¬æ—¶é—´ï¼ˆ+8 å°æ—¶ï¼‰
created_at_utc = user['created_at']  # "2025-01-15T02:30:00Z"
created_at_local = datetime.fromisoformat(created_at_utc.replace('Z', '+00:00'))
created_at_beijing = created_at_local.astimezone(timezone(timedelta(hours=8)))
```

### Q4: å¦‚ä½•é˜²æ­¢ SQL æ³¨å…¥ï¼Ÿ

**A**: ç”¨ Supabase SDK æˆ– ORMï¼Œ**ä¸è¦**è‡ªå·±æ‹¼æ¥ SQLã€‚

```python
# âŒ å±é™©ï¼ˆå¯èƒ½è¢« SQL æ³¨å…¥ï¼‰
username = request.username
query = f"SELECT * FROM users WHERE username = '{username}'"

# âœ… å®‰å…¨ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
supabase.table('users').select("*").eq('username', username).execute()
```

---

## ğŸ’¡ Vibe Coding æç¤º

**åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å·²ç»ç†è§£ï¼š**

1. æ•°æ®åº“å°±æ˜¯ Excel è¡¨æ ¼ï¼ˆè¿™æ˜¯æ ¸å¿ƒç†è§£ï¼‰
2. SQL æ˜¯å¢åˆ æ”¹æŸ¥çš„è¯­è¨€ï¼ˆæ‡‚æ¦‚å¿µå°±è¡Œï¼Œä¸ç”¨èƒŒï¼‰
3. Supabase SDK æ“ä½œæ•°æ®åº“å¾ˆç®€å•ï¼ˆå¤åˆ¶ä»£ç æ”¹æ”¹å°±èƒ½ç”¨ï¼‰
4. ç”¨æˆ·æ³¨å†Œæ¥å£å¯ä»¥è¿æ¥çœŸå®æ•°æ®åº“äº†ï¼ˆä½ åšå‡ºæ¥çœŸä¸œè¥¿äº†ï¼ï¼‰

**è¿˜ä¸å¤ªæ‡‚ï¼Ÿæ²¡å…³ç³»ï¼è¿™æ ·åšï¼š**

1. **å…ˆè·‘é€šä»£ç **ï¼š
   - æŠŠä¸Šé¢çš„ä»£ç å¤åˆ¶ä¸‹æ¥
   - æ›¿æ¢ä½ è‡ªå·±çš„ Supabase URL å’Œ Key
   - è¿è¡Œä¸€éï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æˆåŠŸ

2. **é‡åˆ°æŠ¥é”™ä¸è¦æ…Œ**ï¼š
   - å¤åˆ¶å®Œæ•´çš„æŠ¥é”™ä¿¡æ¯
   - é—® AIï¼š"æˆ‘è¿è¡ŒXXä»£ç æŠ¥é”™äº†ï¼š[ç²˜è´´æŠ¥é”™]ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"
   - AI ä¼šå‘Šè¯‰ä½ å…·ä½“é—®é¢˜åœ¨å“ªé‡Œ

3. **ç”¨ AI å¸®ä½ å†™ä»£ç **ï¼š
   - ä¸éœ€è¦è®°ä½è¯­æ³•ï¼
   - å½“ä½ æƒ³åŠ æ–°åŠŸèƒ½æ—¶ï¼Œå¯¹ AI è¯´ï¼š"å¸®æˆ‘å†™ä¸€ä¸ªæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„ Python ä»£ç ï¼Œç”¨ Supabase SDK"
   - æŠŠ AI ç”Ÿæˆçš„ä»£ç å¤åˆ¶è¿›å»ï¼Œæµ‹è¯•ä¸€ä¸‹å°±è¡Œ

4. **éªŒè¯ AI å†™å¾—å¯¹ä¸å¯¹**ï¼š
   - è¿è¡Œä»£ç ï¼Œçœ‹çœ‹ç»“æœå¯¹ä¸å¯¹
   - å» Supabase Table Editor çœ‹çœ‹æ•°æ®æœ‰æ²¡æœ‰å˜åŒ–
   - å¦‚æœä¸å¯¹ï¼ŒæŠŠç»“æœå‘Šè¯‰ AIï¼Œå®ƒä¼šå¸®ä½ è°ƒæ•´

**è®°ä½ Vibe Coding çš„æ ¸å¿ƒ**ï¼š
- ä½ éœ€è¦ç†è§£"ä¸ºä»€ä¹ˆè¿™æ ·åš"ï¼ˆæ¯”å¦‚ä¸ºä»€ä¹ˆè¦åŠ å¯†å¯†ç ï¼‰
- å…·ä½“è¯­æ³•è®© AI å¸®ä½ å†™ï¼ˆæ¯”å¦‚ `supabase.table().insert()` çš„å†™æ³•ï¼‰
- æ•°æ®åº“åªæ˜¯å­˜æ•°æ®çš„åœ°æ–¹ï¼Œåˆ«è¢«æŠ€æœ¯æœ¯è¯­å“åˆ°

**AI åä½œæ¸…å•**ï¼ˆæ”¶è—è¿™ä¸ªï¼ï¼‰ï¼š
- "å¸®æˆ‘è®¾è®¡ä¸€ä¸ªXXè¡¨ï¼Œéœ€è¦å­˜å‚¨XXXä¿¡æ¯"ï¼ˆè®¾è®¡è¡¨ç»“æ„ï¼‰
- "å¸®æˆ‘å†™ä¸€ä¸ªæŸ¥è¯¢XXçš„ Python ä»£ç ï¼Œç”¨ Supabase SDK"ï¼ˆå†™æŸ¥è¯¢ä»£ç ï¼‰
- "æˆ‘çš„ä»£ç æŠ¥é”™äº†ï¼š[æŠ¥é”™å†…å®¹]ï¼Œæ€ä¹ˆåŠï¼Ÿ"ï¼ˆè°ƒè¯•æŠ¥é”™ï¼‰
- "è¿™æ®µä»£ç æ˜¯ä»€ä¹ˆæ„æ€ï¼š[ç²˜è´´ä»£ç ]"ï¼ˆç†è§£ä»£ç é€»è¾‘ï¼‰
- "æ€ä¹ˆéªŒè¯è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸æ˜¯æ­£å¸¸çš„ï¼Ÿ"ï¼ˆæµ‹è¯•éªŒè¯ï¼‰

---

## ğŸ“š ä¸‹ä¸€æ­¥

ğŸ‘‰ [å®Œæ•´åŠŸèƒ½å®ç°](./05_å®Œæ•´åŠŸèƒ½.md)

å­¦ä¹ ä¸‰å±‚æ¶æ„ã€JWT è®¤è¯ï¼Œå®ç°ç”Ÿäº§çº§åˆ«çš„åç«¯ä»£ç ã€‚

è¿”å› [åç«¯å¼€å‘åŸºç¡€](./README.md) æŸ¥çœ‹å®Œæ•´ç›®å½•ã€‚
