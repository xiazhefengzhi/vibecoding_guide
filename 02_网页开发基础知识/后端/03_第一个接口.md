# ç¬¬ä¸€ä¸ªæ¥å£

> **æ–¹æ³•è®º**: ä» Hello World åˆ°ç”¨æˆ·æ³¨å†Œï¼Œä¸€æ­¥æ­¥å†™å‡ºçœŸæ­£å¯ç”¨çš„ APIã€‚

---

## ğŸ“– æœ¬èŠ‚ç›®æ ‡

å­¦å®Œæœ¬èŠ‚ï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… å†™å‡ºç¬¬ä¸€ä¸ª Hello World æ¥å£
- âœ… ç†è§£è·¯ç”±ã€å‚æ•°ã€å“åº”çš„æ¦‚å¿µ
- âœ… ä½¿ç”¨ Pydantic è‡ªåŠ¨éªŒè¯æ•°æ®
- âœ… å®ç°ç”¨æˆ·æ³¨å†Œæ¥å£
- âœ… ç”¨ /docs è‡ªåŠ¨æ–‡æ¡£æµ‹è¯•æ¥å£

**é¢„è®¡ç”¨æ—¶**: 40 åˆ†é’Ÿ

---

## 0. ç¯å¢ƒå‡†å¤‡ï¼ˆå¿…çœ‹ï¼ï¼‰

### 0.1 å®‰è£…å¿…è¦çš„åº“

åœ¨å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€äº›å·¥å…·ï¼ˆå°±åƒè£…ä¿®å‰å…ˆä¹°å·¥å…·ï¼‰ã€‚

**æ‰“å¼€ç»ˆç«¯ï¼ˆé»‘æ¡†æ¡†ï¼‰**ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
pip install fastapi uvicorn[standard] pydantic[email]
```

**è¿™è¡Œå‘½ä»¤åšäº†ä»€ä¹ˆï¼Ÿ**
- `fastapi`ï¼šåç«¯æ¡†æ¶ï¼Œç”¨æ¥å†™ API
- `uvicorn`ï¼šæœåŠ¡å™¨ï¼Œç”¨æ¥è¿è¡Œä½ çš„ API
- `pydantic[email]`ï¼šæ•°æ®éªŒè¯åº“ï¼Œå¸¦é‚®ç®±æ ¼å¼éªŒè¯åŠŸèƒ½

**é¢„æœŸç»“æœ**ï¼š
çœ‹åˆ°ç±»ä¼¼ "Successfully installed fastapi-0.xx.x uvicorn-0.xx.x..." çš„æç¤ºå°±æˆåŠŸäº†ã€‚

**é‡åˆ°æŠ¥é”™ï¼Ÿä¸è¦æ…Œï¼**
- å¦‚æœæç¤º "pip ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤"ï¼Œè¯´æ˜ Python æ²¡è£…å¥½ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯å¤åˆ¶ç»™ AI é—®æ€ä¹ˆè§£å†³
- å¦‚æœæç¤ºæƒé™é”™è¯¯ï¼Œåœ¨å‘½ä»¤å‰åŠ  `sudo`ï¼ˆMac/Linuxï¼‰æˆ–ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼ˆWindowsï¼‰

---

## 1. Hello World æ¥å£

### 1.1 æœ€ç®€å•çš„æ¥å£

åˆ›å»º `main.py`ï¼š

```python
from fastapi import FastAPI

# åˆ›å»ºåº”ç”¨å®ä¾‹
app = FastAPI()

# å®šä¹‰æ ¹è·¯ç”±
@app.get("/")
def root():
    return {"message": "Hello World"}

# å¯åŠ¨åº”ç”¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

**è¿è¡Œ**:

```bash
python main.py
```

**è®¿é—®**: http://localhost:8000

ä¼šçœ‹åˆ°ï¼š

```json
{"message": "Hello World"}
```

### 1.2 ç†è§£ä»£ç 

```python
@app.get("/")  # â† è£…é¥°å™¨ï¼šå‘Šè¯‰ FastAPI è¿™æ˜¯ä¸€ä¸ª GET è¯·æ±‚ï¼Œè·¯å¾„æ˜¯ "/"
def root():    # â† å‡½æ•°åéšä¾¿èµ·ï¼Œä½†è¦è§åçŸ¥æ„
    return {"message": "Hello World"}  # â† è¿”å› JSON æ•°æ®
```

**ç±»æ¯”ç†è§£**:

```
@app.get("/")  = åœ¨é¤å…é—¨å£æŒ‚ç‰Œå­ï¼š"è¿™é‡Œæ˜¯å¤§é—¨"
def root()     = å®šä¹‰ï¼šå®¢äººè¿›é—¨åè¦åšä»€ä¹ˆ
return {...}   = ç»™å®¢äººå›å¤ï¼š"ä½ å¥½ï¼Œæ¬¢è¿å…‰ä¸´"
```

### 1.3 è‡ªåŠ¨æ–‡æ¡£

FastAPI æœ€å¼ºå¤§çš„åŠŸèƒ½ï¼š**è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£**

è®¿é—®ï¼šhttp://localhost:8000/docs

ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæ¼‚äº®çš„äº¤äº’å¼æ–‡æ¡£ï¼ˆSwagger UIï¼‰ï¼Œå¯ä»¥ç›´æ¥æµ‹è¯•æ¥å£ï¼

---

## 2. ç†è§£è·¯ç”±å’Œå‚æ•°

### 2.1 è·¯å¾„å‚æ•°ï¼ˆPath Parametersï¼‰

**åœºæ™¯**: è·å–æŒ‡å®š ID çš„ç”¨æˆ·ä¿¡æ¯

```python
@app.get("/users/{user_id}")
def get_user(user_id: int):
    return {"user_id": user_id, "username": f"user_{user_id}"}
```

**è®¿é—®**: http://localhost:8000/users/123

**è¿”å›**:

```json
{"user_id": 123, "username": "user_123"}
```

**ç†è§£**:

- `{user_id}` æ˜¯å ä½ç¬¦ï¼Œå¯ä»¥åŒ¹é…ä»»æ„å†…å®¹
- `user_id: int` è‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è½¬æˆæ•´æ•°
- å¦‚æœè®¿é—® `/users/abc`ï¼ŒFastAPI ä¼šè‡ªåŠ¨è¿”å› 400 é”™è¯¯ï¼ˆç±»å‹ä¸åŒ¹é…ï¼‰

**å°çŸ¥è¯†ï¼šf-string æ˜¯ä»€ä¹ˆï¼Ÿ**

ä»£ç ä¸­çš„ `f"user_{user_id}"` æ˜¯ Python çš„ f-stringï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ï¼Œä½œç”¨æ˜¯æŠŠå˜é‡å¡«è¿›å­—ç¬¦ä¸²ã€‚

```python
# æ™®é€šæ‹¼æ¥ï¼ˆç¹çï¼‰
username = "user_" + str(user_id)

# f-stringï¼ˆç®€æ´ï¼‰
username = f"user_{user_id}"  # èŠ±æ‹¬å·é‡Œçš„å˜é‡ä¼šè‡ªåŠ¨æ›¿æ¢
```

**ç±»æ¯”ç†è§£**ï¼šå°±åƒå¡«ç©ºé¢˜ï¼Œ`f"user_{user_id}"` è¡¨ç¤º"user_" + è¿™é‡Œå¡« user_id çš„å€¼ã€‚

**ä½ åªéœ€è¦è®°ä½**ï¼šçœ‹åˆ° `f"...{å˜é‡}..."` å°±æ˜¯åœ¨åšå­—ç¬¦ä¸²å¡«ç©ºï¼Œè®© AI å¸®ä½ å†™å°±è¡Œï¼

### 2.2 æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰

**åœºæ™¯**: æœç´¢åŠŸèƒ½ï¼Œå¸¦åˆ†é¡µ

```python
@app.get("/search")
def search(q: str, skip: int = 0, limit: int = 10):
    return {
        "query": q,
        "skip": skip,
        "limit": limit,
        "results": [f"ç»“æœ {i}" for i in range(1, limit + 1)]
    }
```

**è®¿é—®**: http://localhost:8000/search?q=Python&skip=0&limit=5

**è¿”å›**:

```json
{
  "query": "Python",
  "skip": 0,
  "limit": 5,
  "results": ["ç»“æœ 1", "ç»“æœ 2", "ç»“æœ 3", "ç»“æœ 4", "ç»“æœ 5"]
}
```

**ç†è§£**:

- æŸ¥è¯¢å‚æ•°åœ¨ URL åé¢ï¼Œç”¨ `?` å¼€å¤´ï¼Œ`&` è¿æ¥
- `skip: int = 0` è¡¨ç¤ºæœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸ä¼ 
- `q: str` æ²¡æœ‰é»˜è®¤å€¼ï¼Œå¿…é¡»ä¼ 

### 2.3 è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰

**åœºæ™¯**: ç”¨æˆ·æäº¤è¡¨å•æ•°æ®

```python
from pydantic import BaseModel

# å®šä¹‰æ•°æ®æ¨¡å‹
class Item(BaseModel):
    name: str
    price: float
    description: str = None  # å¯é€‰å­—æ®µ

@app.post("/items")
def create_item(item: Item):
    return {
        "message": "åˆ›å»ºæˆåŠŸ",
        "item": {
            "name": item.name,
            "price": item.price,
            "description": item.description
        }
    }
```

**æµ‹è¯•**ï¼ˆç”¨ /docs æˆ– Postmanï¼‰:

**è¯·æ±‚**:

```json
POST /items
{
  "name": "è‹¹æœ",
  "price": 5.5,
  "description": "æ–°é²œçš„è‹¹æœ"
}
```

**è¿”å›**:

```json
{
  "message": "åˆ›å»ºæˆåŠŸ",
  "item": {
    "name": "è‹¹æœ",
    "price": 5.5,
    "description": "æ–°é²œçš„è‹¹æœ"
  }
}
```

---

## 3. Pydantic æ•°æ®éªŒè¯

### 3.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®éªŒè¯ï¼Ÿ

**ä¸éªŒè¯çš„åæœ**:

```python
@app.post("/users")
def create_user(username, password):
    # âŒ ç”¨æˆ·å¯èƒ½ä¼ å…¥ä»»ä½•æ•°æ®
    # username = ""  ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
    # password = 123  ï¼ˆä¸æ˜¯å­—ç¬¦ä¸²ï¼‰
    # ä½ éœ€è¦æ‰‹åŠ¨å†™ä¸€å † if åˆ¤æ–­
    ...
```

**ç”¨ Pydantic è‡ªåŠ¨éªŒè¯**:

```python
from pydantic import BaseModel, Field, EmailStr

class UserRegisterRequest(BaseModel):
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=6)
    email: EmailStr  # è‡ªåŠ¨éªŒè¯é‚®ç®±æ ¼å¼

@app.post("/users/register")
def register(user: UserRegisterRequest):
    # âœ… åˆ°è¿™é‡Œï¼Œæ•°æ®ä¸€å®šæ˜¯åˆæ³•çš„
    # username é•¿åº¦ 3-50
    # password é•¿åº¦ >= 6
    # email æ ¼å¼æ­£ç¡®
    return {"message": "æ³¨å†ŒæˆåŠŸ"}
```

### 3.2 Field éªŒè¯è§„åˆ™

```python
from pydantic import BaseModel, Field

class UserModel(BaseModel):
    # å¿…å¡«ï¼Œé•¿åº¦ 3-50
    username: str = Field(..., min_length=3, max_length=50)

    # å¿…å¡«ï¼Œæœ€å°‘ 6 ä¸ªå­—ç¬¦
    password: str = Field(..., min_length=6)

    # å¯é€‰ï¼Œ1-120 ä¹‹é—´
    age: int = Field(None, ge=1, le=120)

    # å¯é€‰ï¼Œé»˜è®¤å€¼æ˜¯ False
    is_active: bool = Field(default=True)
```

**å¸¸ç”¨éªŒè¯è§„åˆ™**:

| è§„åˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `...` | å¿…å¡«ï¼ˆæ²¡æœ‰é»˜è®¤å€¼ï¼‰ | `Field(...)` |
| `default=xxx` | é»˜è®¤å€¼ | `Field(default=0)` |
| `min_length` | æœ€å°é•¿åº¦ | `Field(..., min_length=3)` |
| `max_length` | æœ€å¤§é•¿åº¦ | `Field(..., max_length=50)` |
| `ge` | å¤§äºç­‰äºï¼ˆgreater or equalï¼‰ | `Field(None, ge=1)` |
| `le` | å°äºç­‰äºï¼ˆless or equalï¼‰ | `Field(None, le=120)` |
| `regex` | æ­£åˆ™è¡¨è¾¾å¼ | `Field(..., regex=r'^[a-z0-9]+$')` |

### 3.3 è‡ªåŠ¨é”™è¯¯æç¤º

å¦‚æœç”¨æˆ·ä¼ å…¥ä¸åˆæ³•çš„æ•°æ®ï¼ŒFastAPI ä¼šè‡ªåŠ¨è¿”å›è¯¦ç»†é”™è¯¯ï¼š

**è¯·æ±‚**:

```json
POST /users/register
{
  "username": "ab",  â† å¤ªçŸ­ï¼ˆæœ€å°‘ 3 ä¸ªå­—ç¬¦ï¼‰
  "password": "123",  â† å¤ªçŸ­ï¼ˆæœ€å°‘ 6 ä¸ªå­—ç¬¦ï¼‰
  "email": "not-an-email"  â† æ ¼å¼é”™è¯¯
}
```

**è¿”å›**:

```json
{
  "detail": [
    {
      "loc": ["body", "username"],
      "msg": "ensure this value has at least 3 characters",
      "type": "value_error.any_str.min_length"
    },
    {
      "loc": ["body", "password"],
      "msg": "ensure this value has at least 6 characters",
      "type": "value_error.any_str.min_length"
    },
    {
      "loc": ["body", "email"],
      "msg": "value is not a valid email address",
      "type": "value_error.email"
    }
  ]
}
```

**ç”¨æˆ·çœ‹åˆ°æ¸…æ™°çš„é”™è¯¯æç¤ºï¼** ä½ ä¸ç”¨å†™ä¸€è¡ŒéªŒè¯ä»£ç ï¼

---

## 4. å®æˆ˜ï¼šç”¨æˆ·æ³¨å†Œæ¥å£

### 4.1 éœ€æ±‚åˆ†æ

**æ¥å£è·¯å¾„**: `POST /api/users/register`

**è¯·æ±‚å‚æ•°**:
- `username`: ç”¨æˆ·åï¼ˆ3-50 å­—ç¬¦ï¼‰
- `password`: å¯†ç ï¼ˆæœ€å°‘ 6 å­—ç¬¦ï¼‰
- `email`: é‚®ç®±ï¼ˆå¯é€‰ï¼Œæ ¼å¼éªŒè¯ï¼‰

**è¿”å›æ ¼å¼**:

```json
{
  "code": 200,
  "msg": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user_id": 123
  }
}
```

### 4.2 å®Œæ•´ä»£ç 

**ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ•°æ®æ¨¡å‹**

```python
from pydantic import BaseModel, Field, EmailStr
from typing import Optional

class UserRegisterRequest(BaseModel):
    """ç”¨æˆ·æ³¨å†Œè¯·æ±‚æ¨¡å‹"""
    username: str = Field(..., min_length=3, max_length=50, description="ç”¨æˆ·å")
    password: str = Field(..., min_length=6, description="å¯†ç ")
    email: Optional[EmailStr] = Field(None, description="é‚®ç®±")

    class Config:
        # åœ¨ /docs æ–‡æ¡£ä¸­æ˜¾ç¤ºçš„ç¤ºä¾‹ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
        schema_extra = {
            "example": {
                "username": "zhangsan",
                "password": "123456",
                "email": "zhangsan@example.com"
            }
        }
```

**å…³äº `class Config` çš„è¯´æ˜ï¼ˆå¯è·³è¿‡ï¼‰**ï¼š

è¿™æ˜¯ Pydantic çš„é…ç½®ç±»ï¼Œç”¨æ¥ç»™ FastAPI çš„ `/docs` æ–‡æ¡£æä¾›æµ‹è¯•ç¤ºä¾‹æ•°æ®ã€‚

**ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ªï¼Ÿ**
- ä¸å†™ä¹Ÿèƒ½è·‘ï¼Œä½†å†™äº†ä¹‹ååœ¨ `/docs` æµ‹è¯•æ—¶ä¼šè‡ªåŠ¨å¡«å¥½ç¤ºä¾‹æ•°æ®ï¼Œçœå¾—ä½ æ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥ã€‚

**ç±»æ¯”ç†è§£**ï¼šå°±åƒç»™è¡¨å•é¢„å¡«äº†ä¸€ä¸ª"å¼ ä¸‰"çš„ç¤ºä¾‹ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿæµ‹è¯•ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æƒ³ç”¨æˆ·åã€‚

**Vibe Coding å»ºè®®**ï¼šå…ˆæŠŠä»£ç è·‘é€šï¼Œè¿™ä¸ª `Config` å¯ä»¥ä»¥åå†åŠ ã€‚å¦‚æœä½ è§‰å¾—å®ƒå¤æ‚ï¼Œå¯ä»¥ç›´æ¥åˆ æ‰ï¼Œä¸å½±å“åŠŸèƒ½ï¼

**ç¬¬äºŒæ­¥ï¼šå®šä¹‰ç»Ÿä¸€å“åº”æ ¼å¼**

> **Vibe Coding æç¤º**ï¼šè¿™éƒ¨åˆ†ä»£ç æ¯”è¾ƒå¤æ‚ï¼ˆæ¶‰åŠ `class`ã€`@staticmethod` ç­‰è¯­æ³•ï¼‰ï¼Œä½†å¥½æ¶ˆæ¯æ˜¯ï¼š**ä½ åªéœ€è¦ç†è§£å®ƒçš„ä½œç”¨ï¼Œå…·ä½“è¯­æ³•è®© AI å†™ï¼**

```python
from typing import Optional, Any

class Response(BaseModel):
    """ç»Ÿä¸€å“åº”æ ¼å¼"""
    code: int          # çŠ¶æ€ç ï¼ˆ200=æˆåŠŸï¼Œ400/500=å¤±è´¥ï¼‰
    msg: str           # æç¤ºä¿¡æ¯ï¼ˆç»™ç”¨æˆ·çœ‹çš„æ–‡å­—ï¼‰
    data: Optional[Any] = None  # è¿”å›æ•°æ®ï¼ˆå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼‰

class R:
    """å“åº”å·¥å…·ç±»ï¼ˆå¿«é€Ÿç”Ÿæˆå“åº”çš„å·¥å…·ç®±ï¼‰"""

    @staticmethod
    def success(data: Any = None, msg: str = "æ“ä½œæˆåŠŸ"):
        return Response(code=200, msg=msg, data=data)

    @staticmethod
    def error(msg: str = "æ“ä½œå¤±è´¥", code: int = 500):
        return Response(code=code, msg=msg, data=None)
```

**ä½ åªéœ€è¦è®°ä½**ï¼š
- `R.success(data={...})` = è¿”å›æˆåŠŸæ¶ˆæ¯
- `R.error(msg="å¤±è´¥åŸå› ")` = è¿”å›é”™è¯¯æ¶ˆæ¯

**å…³äºè¯­æ³•ç»†èŠ‚ï¼ˆå¯ä»¥è·³è¿‡ï¼‰**ï¼š
- `Optional[Any]`ï¼šè¡¨ç¤ºè¿™ä¸ªå­—æ®µå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¸ºç©ºï¼ˆè®© AI å¸®ä½ å†™ï¼‰
- `@staticmethod`ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ç”¨ `R.success()` è°ƒç”¨ï¼ˆè®© AI å¸®ä½ å†™ï¼‰
- å¦‚æœä½ çœ‹åˆ°è¿™äº›è¯­æ³•è§‰å¾—å¤´æ™•ï¼Œ**å®Œå…¨å¯ä»¥è·³è¿‡ï¼** å…ˆæŠŠåŠŸèƒ½è·‘é€šï¼Œä»¥åå†æ…¢æ…¢ç†è§£ã€‚

**ç±»æ¯”ç†è§£**ï¼š`class R` å°±åƒä¸€ä¸ªä¸‡èƒ½å›å¤æ¨¡æ¿ç”Ÿæˆå™¨ã€‚ä½ åªéœ€è¦å‘Šè¯‰å®ƒ"æˆåŠŸäº†"æˆ–"å¤±è´¥äº†"ï¼Œå®ƒå°±è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†æ ¼å¼çš„å›å¤ã€‚

**ç¬¬ä¸‰æ­¥ï¼šå®ç°æ³¨å†Œæ¥å£**

```python
from fastapi import FastAPI, HTTPException
import hashlib

app = FastAPI(title="æˆ‘çš„åç«¯ API")

# æ¨¡æ‹Ÿæ•°æ®åº“ï¼ˆçœŸå®é¡¹ç›®ä¼šç”¨ Supabaseï¼‰
users_db = []

**é‡è¦æç¤ºï¼šå…³äº"æ¨¡æ‹Ÿæ•°æ®åº“"**

è¿™é‡Œç”¨åˆ—è¡¨ `[]` æ¥æ¨¡æ‹Ÿæ•°æ®åº“ï¼Œ**æ•°æ®åªå­˜åœ¨å†…å­˜é‡Œ**ã€‚è¿™æ„å‘³ç€ï¼š
- âœ… ç¨‹åºè¿è¡Œæ—¶ï¼Œæ³¨å†Œçš„ç”¨æˆ·ä¼šä¿å­˜åœ¨ `users_db` é‡Œ
- âŒ å…³é—­ç¨‹åºåå†é‡å¯ï¼Œæ‰€æœ‰ç”¨æˆ·æ•°æ®ä¼šæ¶ˆå¤±

**ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨çœŸæ•°æ®åº“ï¼Ÿ**
å› ä¸ºæˆ‘ä»¬è¦å…ˆå­¦ä¼š"æ€ä¹ˆå†™æ¥å£é€»è¾‘"ï¼Œæ•°æ®åº“æ˜¯ä¸‹ä¸€ç« çš„å†…å®¹ã€‚å°±åƒå­¦å¼€è½¦è¦å…ˆå­¦æ–¹å‘ç›˜ï¼Œå†å­¦å€’è½¦å…¥åº“ã€‚

**ç±»æ¯”ç†è§£**ï¼š`users_db = []` å°±åƒåœ¨è‰ç¨¿çº¸ä¸Šè®°ç¬”è®°ï¼Œæ“¦æ‰å°±æ²¡äº†ã€‚çœŸæ­£çš„æ•°æ®åº“ï¼ˆSupabaseï¼‰æ‰æ˜¯è®°åœ¨æœ¬å­ä¸Šï¼Œæ°¸ä¹…ä¿å­˜ã€‚

---

@app.post("/api/users/register", response_model=Response)
def register(user: UserRegisterRequest):
    """
    ç”¨æˆ·æ³¨å†Œæ¥å£

    - **username**: ç”¨æˆ·åï¼ˆ3-50 å­—ç¬¦ï¼‰
    - **password**: å¯†ç ï¼ˆæœ€å°‘ 6 å­—ç¬¦ï¼‰
    - **email**: é‚®ç®±ï¼ˆå¯é€‰ï¼‰
    """

    # 1. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
    for existing_user in users_db:
        if existing_user["username"] == user.username:
            return R.error(msg="ç”¨æˆ·åå·²å­˜åœ¨", code=400)

    # 2. å¯†ç åŠ å¯†ï¼ˆå®é™…é¡¹ç›®ç”¨ bcryptï¼Œè¿™é‡Œç®€åŒ–æ¼”ç¤ºï¼‰
    password_hash = hashlib.sha256(user.password.encode()).hexdigest()

    # ğŸ‘† è¿™è¡Œä»£ç çœ‹èµ·æ¥å¾ˆå“äººï¼Ÿåˆ«æ…Œï¼ä½ åªéœ€è¦çŸ¥é“å®ƒåšäº†ä»€ä¹ˆï¼š
    # - æŠŠå¯†ç ï¼ˆå¦‚ "123456"ï¼‰å˜æˆä¸€ä¸²ä¹±ç ï¼ˆå¦‚ "8d969eef6..."ï¼‰
    # - è¿™æ ·å³ä½¿æ•°æ®åº“è¢«é»‘å®¢å·èµ°ï¼Œé»‘å®¢ä¹Ÿçœ‹ä¸æ‡‚åŸå§‹å¯†ç 
    # - å…·ä½“æ€ä¹ˆå†™ï¼Ÿç›´æ¥é—® AIï¼š"å¸®æˆ‘å†™å¯†ç åŠ å¯†ä»£ç "

    # 3. å­˜å…¥"æ•°æ®åº“"
    new_user = {
        "user_id": len(users_db) + 1,
        "username": user.username,
        "password_hash": password_hash,
        "email": user.email
    }
    users_db.append(new_user)

    # 4. è¿”å›æˆåŠŸå“åº”
    return R.success(
        msg="æ³¨å†ŒæˆåŠŸ",
        data={"user_id": new_user["user_id"]}
    )
```

### 4.3 æµ‹è¯•æ¥å£

**æ–¹å¼1: ä½¿ç”¨ /docs**

1. è®¿é—® http://localhost:8000/docs
2. æ‰¾åˆ° `POST /api/users/register`
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥æ•°æ®ï¼š
   ```json
   {
     "username": "zhangsan",
     "password": "123456",
     "email": "zhang@example.com"
   }
   ```
5. ç‚¹å‡» "Execute"
6. çœ‹åˆ°è¿”å›ç»“æœï¼š
   ```json
   {
     "code": 200,
     "msg": "æ³¨å†ŒæˆåŠŸ",
     "data": {
       "user_id": 1
     }
   }
   ```

**æ–¹å¼2: ä½¿ç”¨ Postman æˆ– Thunder Client**

**è¯·æ±‚**:

```
POST http://localhost:8000/api/users/register
Content-Type: application/json

{
  "username": "lisi",
  "password": "abc123",
  "email": "li@example.com"
}
```

**è¿”å›**:

```json
{
  "code": 200,
  "msg": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user_id": 2
  }
}
```

### 4.4 æµ‹è¯•è¾¹ç•Œæƒ…å†µ

**æµ‹è¯•1: ç”¨æˆ·åå¤ªçŸ­**

```json
{
  "username": "ab",
  "password": "123456"
}
```

**è¿”å›**:

```json
{
  "detail": [
    {
      "loc": ["body", "username"],
      "msg": "ensure this value has at least 3 characters",
      "type": "value_error.any_str.min_length"
    }
  ]
}
```

**æµ‹è¯•2: é‡å¤ç”¨æˆ·å**

å†æ¬¡æäº¤ `username: "zhangsan"`

**è¿”å›**:

```json
{
  "code": 400,
  "msg": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null
}
```

**æµ‹è¯•3: é‚®ç®±æ ¼å¼é”™è¯¯**

```json
{
  "username": "wangwu",
  "password": "123456",
  "email": "not-an-email"
}
```

**è¿”å›**:

```json
{
  "detail": [
    {
      "loc": ["body", "email"],
      "msg": "value is not a valid email address",
      "type": "value_error.email"
    }
  ]
}
```

---

## 5. å®Œæ•´ä»£ç ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰

```python
from fastapi import FastAPI
from pydantic import BaseModel, Field, EmailStr
from typing import Optional, Any
import hashlib

# ===== æ•°æ®æ¨¡å‹ =====

class UserRegisterRequest(BaseModel):
    """ç”¨æˆ·æ³¨å†Œè¯·æ±‚æ¨¡å‹"""
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=6)
    email: Optional[EmailStr] = None

    class Config:
        schema_extra = {
            "example": {
                "username": "zhangsan",
                "password": "123456",
                "email": "zhang@example.com"
            }
        }

class Response(BaseModel):
    """ç»Ÿä¸€å“åº”æ ¼å¼"""
    code: int
    msg: str
    data: Optional[Any] = None

# ===== å“åº”å·¥å…·ç±» =====

class R:
    @staticmethod
    def success(data: Any = None, msg: str = "æ“ä½œæˆåŠŸ"):
        return Response(code=200, msg=msg, data=data)

    @staticmethod
    def error(msg: str = "æ“ä½œå¤±è´¥", code: int = 500):
        return Response(code=code, msg=msg, data=None)

# ===== FastAPI åº”ç”¨ =====

app = FastAPI(title="æˆ‘çš„åç«¯ API", version="1.0.0")

# æ¨¡æ‹Ÿæ•°æ®åº“
users_db = []

@app.get("/")
def root():
    """æ ¹è·¯å¾„"""
    return {"message": "Hello World"}

@app.post("/api/users/register", response_model=Response)
def register(user: UserRegisterRequest):
    """ç”¨æˆ·æ³¨å†Œæ¥å£"""

    # æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
    for existing_user in users_db:
        if existing_user["username"] == user.username:
            return R.error(msg="ç”¨æˆ·åå·²å­˜åœ¨", code=400)

    # å¯†ç åŠ å¯†
    password_hash = hashlib.sha256(user.password.encode()).hexdigest()

    # å­˜å…¥æ•°æ®åº“
    new_user = {
        "user_id": len(users_db) + 1,
        "username": user.username,
        "password_hash": password_hash,
        "email": user.email
    }
    users_db.append(new_user)

    return R.success(
        msg="æ³¨å†ŒæˆåŠŸ",
        data={"user_id": new_user["user_id"]}
    )

@app.get("/api/users")
def list_users():
    """æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ï¼ˆæµ‹è¯•ç”¨ï¼‰"""
    return R.success(data=users_db)

# ===== å¯åŠ¨åº”ç”¨ =====

if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

**ä¿å­˜ä¸º `main.py`ï¼Œè¿è¡Œï¼š**

```bash
python main.py
```

**è®¿é—®**: http://localhost:8000/docs

**æ­å–œï¼ä½ å·²ç»å†™å‡ºäº†ç¬¬ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„ APIï¼** ğŸ‰

---

## 6. ç†è§£ GET vs POST

| ç‰¹æ€§ | GET | POST |
|------|-----|------|
| **ç”¨é€”** | æŸ¥è¯¢æ•°æ® | åˆ›å»º/æäº¤æ•°æ® |
| **å‚æ•°ä½ç½®** | URL æŸ¥è¯¢å‚æ•° | è¯·æ±‚ä½“ï¼ˆBodyï¼‰ |
| **æ˜¯å¦å®‰å…¨** | âŒ å‚æ•°å¯è§ | âœ… å‚æ•°éšè— |
| **èƒ½å¦åˆ·æ–°** | âœ… å¯ä»¥åå¤è¯·æ±‚ | âŒ å¯èƒ½é‡å¤æäº¤ |
| **ç¤ºä¾‹** | `/search?q=Python` | `/api/users/register` |

**ä»€ä¹ˆæ—¶å€™ç”¨ GETï¼Ÿ**

- è·å–åˆ—è¡¨ï¼ˆæ–‡ç« åˆ—è¡¨ã€å•†å“åˆ—è¡¨ï¼‰
- æŸ¥è¯¢è¯¦æƒ…ï¼ˆç”¨æˆ·ä¿¡æ¯ã€è®¢å•è¯¦æƒ…ï¼‰
- æœç´¢åŠŸèƒ½

**ä»€ä¹ˆæ—¶å€™ç”¨ POSTï¼Ÿ**

- åˆ›å»ºæ•°æ®ï¼ˆæ³¨å†Œã€å‘å¸ƒæ–‡ç« ï¼‰
- æäº¤è¡¨å•ï¼ˆç™»å½•ã€è¯„è®ºï¼‰
- ä¸Šä¼ æ–‡ä»¶

---

## 7. å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ç”¨ Pydanticï¼Ÿ

**A**: è‡ªåŠ¨éªŒè¯æ•°æ®ï¼Œå‡å°‘ 90% çš„éªŒè¯ä»£ç ã€‚

**ä¸ç”¨ Pydantic**:

```python
@app.post("/users/register")
def register(username, password, email):
    if not username:
        return {"error": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º"}
    if len(username) < 3:
        return {"error": "ç”¨æˆ·åå¤ªçŸ­"}
    if len(password) < 6:
        return {"error": "å¯†ç å¤ªçŸ­"}
    if email and "@" not in email:
        return {"error": "é‚®ç®±æ ¼å¼é”™è¯¯"}
    # ... 50 è¡ŒéªŒè¯ä»£ç 
```

**ç”¨ Pydantic**:

```python
class UserRegisterRequest(BaseModel):
    username: str = Field(..., min_length=3)
    password: str = Field(..., min_length=6)
    email: EmailStr = None

@app.post("/users/register")
def register(user: UserRegisterRequest):
    # åˆ°è¿™é‡Œæ•°æ®ä¸€å®šåˆæ³•
    ...
```

### Q2: ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€å“åº”æ ¼å¼ï¼Ÿ

**A**: å‰ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†å“åº”ã€‚

```javascript
// å‰ç«¯ä»£ç 
const response = await fetch('/api/users/register', {...});
const result = await response.json();

if (result.code === 200) {
    alert(result.msg);  // "æ³¨å†ŒæˆåŠŸ"
} else {
    alert(result.msg);  // "ç”¨æˆ·åå·²å­˜åœ¨"
}
```

### Q3: å¯†ç ä¸ºä»€ä¹ˆè¦åŠ å¯†ï¼Ÿ

**A**: æ•°æ®åº“è¢«é»‘å®¢å…¥ä¾µæ—¶ï¼Œç”¨æˆ·çš„æ˜æ–‡å¯†ç ä¸ä¼šæ³„éœ²ã€‚

```python
# âŒ æ˜æ–‡å­˜å‚¨
{"username": "zhangsan", "password": "123456"}  # é»‘å®¢ç›´æ¥çœ‹åˆ°å¯†ç 

# âœ… åŠ å¯†å­˜å‚¨
{"username": "zhangsan", "password_hash": "8d969eef6..."}  # é»‘å®¢æ— æ³•åæ¨
```

### Q4: ä¸ºä»€ä¹ˆ /docs æ–‡æ¡£è¿™ä¹ˆæ™ºèƒ½ï¼Ÿ

**A**: FastAPI æ ¹æ®ä½ çš„ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼š

- ä» `@app.post("/api/users/register")` çŸ¥é“è·¯å¾„å’Œæ–¹æ³•
- ä» `UserRegisterRequest` çŸ¥é“å‚æ•°æ ¼å¼
- ä» `class Config: schema_extra` çŸ¥é“ç¤ºä¾‹æ•°æ®
- ä» `response_model=Response` çŸ¥é“è¿”å›æ ¼å¼

---

## ğŸ’¡ Vibe Coding æç¤º

**åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å·²ç»ç†è§£ï¼š**

1. FastAPI æ€ä¹ˆå®šä¹‰è·¯ç”±ï¼ˆ`@app.get`, `@app.post`ï¼‰
2. æ€ä¹ˆæ¥æ”¶å‚æ•°ï¼ˆè·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“ï¼‰
3. Pydantic è‡ªåŠ¨éªŒè¯æ•°æ®
4. æ€ä¹ˆè¿”å›ç»Ÿä¸€æ ¼å¼çš„å“åº”

**è¿˜ä¸å¤ªæ‡‚ï¼Ÿæ²¡å…³ç³»ï¼è¿™å¾ˆæ­£å¸¸ï¼**

**å®æˆ˜å»ºè®®ï¼ˆæŒ‰é¡ºåºåšï¼‰**ï¼š
1. **å…ˆè·‘é€š**ï¼šæŠŠå®Œæ•´ä»£ç ï¼ˆç¬¬ 5 èŠ‚ï¼‰å¤åˆ¶ä¸‹æ¥ï¼Œè¿è¡Œçœ‹æ•ˆæœ
2. **å†æ”¹åŠ¨**ï¼šæ”¹æ”¹å‚æ•°åã€è¿”å›å†…å®¹ï¼Œçœ‹æœ‰ä»€ä¹ˆå˜åŒ–
3. **å¤šæµ‹è¯•**ï¼šåœ¨ `/docs` é‡Œæµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
4. **é‡åˆ°æŠ¥é”™**ï¼š
   - âŒ ä¸è¦æ…Œï¼Œä¸è¦æ”¾å¼ƒ
   - âœ… å¤åˆ¶å®Œæ•´é”™è¯¯ä¿¡æ¯
   - âœ… é—® AIï¼š"è¿™ä¸ªé”™è¯¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"
   - âœ… è®°ä½ï¼šæŠ¥é”™æ˜¯æ­£å¸¸çš„ï¼Œæ‰€æœ‰ç¨‹åºå‘˜æ¯å¤©éƒ½åœ¨æŠ¥é”™å’Œè§£å†³æŠ¥é”™

**å…³äºå¤æ‚è¯­æ³•ï¼ˆ@staticmethodã€Optional[Any] ç­‰ï¼‰**ï¼š
- ä½ ç°åœ¨ä¸éœ€è¦å®Œå…¨ç†è§£å®ƒä»¬
- å…ˆè®°ä½å®ƒä»¬çš„**ä½œç”¨**ï¼ˆæ¯”å¦‚ `R.success()` è¿”å›æˆåŠŸæ¶ˆæ¯ï¼‰
- å…·ä½“æ€ä¹ˆå†™ï¼Ÿ**è®© AI å¸®ä½ å†™**
- ç­‰å†™äº† 5-10 ä¸ªæ¥å£åï¼Œä½ è‡ªç„¶å°±æ‡‚äº†

**Vibe Coding æ ¸å¿ƒåŸåˆ™**ï¼š
- èƒ½è·‘é€š > èƒ½èƒŒä¸‹æ¥
- çŸ¥é“å·¥å…·èƒ½åšä»€ä¹ˆ > çŸ¥é“è¯­æ³•æ€ä¹ˆå†™
- ä¼šé—® AI > æ­»è®°ç¡¬èƒŒ

**è®°ä½**: ä½ ä¸æ˜¯åœ¨å­¦"ä»£ç "ï¼Œä½ æ˜¯åœ¨å­¦"ç”¨ AI è§£å†³é—®é¢˜"ï¼

**AI åä½œç¤ºä¾‹ï¼ˆé‡åˆ°é—®é¢˜å°±è¿™æ ·é—®ï¼‰**ï¼š

```
åœºæ™¯ 1ï¼šæƒ³åŠ æ–°å­—æ®µ
æé—®ï¼š"æˆ‘æƒ³åœ¨ç”¨æˆ·æ³¨å†Œæ—¶å¢åŠ ä¸€ä¸ªæ‰‹æœºå·å­—æ®µï¼Œè¦æ±‚å¿…å¡«ï¼Œ11 ä½æ•°å­—ï¼Œå¸®æˆ‘å†™ Pydantic æ¨¡å‹ä»£ç "

åœºæ™¯ 2ï¼šé‡åˆ°æŠ¥é”™
æé—®ï¼š"æˆ‘è¿è¡Œä»£ç æ—¶é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼š[ç²˜è´´å®Œæ•´é”™è¯¯ä¿¡æ¯]ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"

åœºæ™¯ 3ï¼šæƒ³æ”¹åŠŸèƒ½
æé—®ï¼š"æˆ‘æƒ³æŠŠæ³¨å†Œæ¥å£æ”¹æˆç™»å½•æ¥å£ï¼Œéœ€è¦æ”¹å“ªäº›åœ°æ–¹ï¼Ÿç»™æˆ‘å®Œæ•´ä»£ç "

åœºæ™¯ 4ï¼šä¸æ‡‚è¯­æ³•
æé—®ï¼š"f-string æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­è§£é‡Šä¸€ä¸‹"
```

---

## ğŸ“š ä¸‹ä¸€æ­¥

ğŸ‘‰ [æ•°æ®åº“æ“ä½œ](./04_æ•°æ®åº“æ“ä½œ.md)

å­¦ä¹ å¦‚ä½•ç”¨ Supabase å­˜å‚¨å’ŒæŸ¥è¯¢çœŸå®æ•°æ®ï¼Œå‘Šåˆ«æ¨¡æ‹Ÿæ•°æ®åº“ã€‚

è¿”å› [åç«¯å¼€å‘åŸºç¡€](./README.md) æŸ¥çœ‹å®Œæ•´ç›®å½•ã€‚
